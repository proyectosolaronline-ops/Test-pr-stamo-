<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debug ¬∑ Simulaciones</title>
<style>
  body{font-family:monospace;background:#080b10;color:#dce8f5;padding:16px;font-size:13px}
  h2{color:#00e5b0;margin-bottom:4px;font-family:sans-serif}
  .sub{color:#4d617d;font-size:.8rem;margin-bottom:16px}
  .btn{background:#00e5b0;color:#000;border:none;padding:8px 18px;border-radius:8px;cursor:pointer;font-weight:700;font-size:.85rem;margin-bottom:16px}
  .btn:hover{background:#00b88d}
  .status{margin-bottom:12px;padding:8px 12px;border-radius:8px;font-size:.82rem}
  .status.ok  {background:rgba(0,229,176,.1);border:1px solid rgba(0,229,176,.3);color:#00e5b0}
  .status.err {background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.3);color:#f43f5e}
  .status.inf {background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);color:#3b82f6}
  table{width:100%;border-collapse:collapse;font-size:.75rem;margin-top:8px}
  th{background:#1c2535;color:#7a92b0;padding:6px 8px;text-align:left;border:1px solid #1c2535;white-space:nowrap;position:sticky;top:0}
  td{padding:5px 8px;border:1px solid #1c2535;vertical-align:top;max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  tr:nth-child(even) td{background:#0f1319}
  tr:hover td{background:#141a24}
  .col-id   {color:#00e5b0}
  .col-fecha{color:#7a92b0}
  .col-est  {background:#f59e0b22;color:#f59e0b;border-radius:4px;padding:2px 6px;font-size:.7rem;font-weight:700}
  .wrap-table{overflow-x:auto;border-radius:8px;border:1px solid #1c2535}
  .raw{margin-top:20px}
  .raw summary{cursor:pointer;color:#4d617d;font-size:.8rem;margin-bottom:6px}
  .raw pre{background:#0f1319;padding:12px;border-radius:8px;border:1px solid #1c2535;overflow:auto;max-height:300px;font-size:.7rem;color:#7a92b0;white-space:pre-wrap;word-break:break-all}
  .count{color:#4d617d;font-size:.78rem;margin-bottom:8px}
</style>
</head>
<body>

<h2>üîç Debug ¬∑ Simulaciones</h2>
<div class="sub">Pesta√±a: <b>Simulaciones</b> ¬∑ Sheet ID: 19Viesr9Lhy347A9L03J_RuxftUhBduaYsBY206IO6X8</div>

<button class="btn" onclick="cargar()">‚Üª Cargar datos</button>

<div id="status" class="status inf">Presiona "Cargar datos" para leer la hoja‚Ä¶</div>
<div id="count" class="count"></div>
<div id="tabla"></div>

<details class="raw">
  <summary>‚ñ∂ Ver JSON crudo</summary>
  <pre id="raw">‚Äî</pre>
</details>

<script>
const SHEET_ID = '19Viesr9Lhy347A9L03J_RuxftUhBduaYsBY206IO6X8';
const SHEET    = 'Simulaciones';

const COLS = [
  {k:'A', lbl:'ID'},
  {k:'B', lbl:'Fecha/Hora'},
  {k:'C', lbl:'Nombre'},
  {k:'D', lbl:'Tel√©fono'},
  {k:'E', lbl:'Capital'},
  {k:'F', lbl:'D√≠as'},
  {k:'G', lbl:'Inter√©s %'},
  {k:'H', lbl:'Inter√©s $'},
  {k:'I', lbl:'Total'},
  {k:'J', lbl:'Pago Diario'},
  {k:'K', lbl:'Latitud'},
  {k:'L', lbl:'Longitud'},
  {k:'M', lbl:'Direcci√≥n'},
  {k:'N', lbl:'Link Mapa'},
  {k:'O', lbl:'Foto INE'},
  {k:'P', lbl:'Foto Comp.'},
  {k:'Q', lbl:'Estado'},
  {k:'R', lbl:'Notas'},
];

function set(id, html){ document.getElementById(id).innerHTML = html; }

async function cargar(){
  set('status','<span>‚è≥ Consultando Google Sheets‚Ä¶</span>');
  document.getElementById('status').className = 'status inf';
  set('tabla',''); set('count',''); set('raw','‚Äî');

  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET)}&cache=${Date.now()}`;

  try{
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP ' + r.status);
    const txt  = await r.text();
    const json = JSON.parse(txt.replace(/^[\s\S]*?setResponse\(/,'').replace(/\);[\s\S]*$/,''));

    set('raw', JSON.stringify(json, null, 2));

    const rows = json.table?.rows || [];
    const dataRows = rows.filter(r => r?.c?.some(c => c?.v != null));

    if(!dataRows.length){
      document.getElementById('status').className = 'status inf';
      set('status','‚ÑπÔ∏è La hoja est√° vac√≠a (sin filas de datos)');
      return;
    }

    document.getElementById('status').className = 'status ok';
    set('status', `‚úÖ Lectura exitosa ¬∑ ${new Date().toLocaleTimeString('es-MX')}`);
    set('count', `${dataRows.length} registro${dataRows.length!==1?'s':''} encontrado${dataRows.length!==1?'s':''}`);

    // Tabla
    let th = COLS.map(c=>`<th>${c.lbl}</th>`).join('');
    let tbody = dataRows.map((row,i)=>{
      let tds = COLS.map((c,ci)=>{
        const cell = row?.c?.[ci];
        let val = cell?.f ?? cell?.v ?? '‚Äî';
        if(val === null || val === undefined || val === '') val = '‚Äî';

        let cls = '';
        if(ci===0)  cls = 'col-id';
        if(ci===1)  cls = 'col-fecha';

        // Estado badge
        if(ci===16 && val !== '‚Äî'){
          return `<td><span class="col-est">${val}</span></td>`;
        }
        // Links
        if((ci===13||ci===14||ci===15) && String(val).startsWith('http')){
          return `<td><a href="${val}" target="_blank" style="color:#3b82f6">üîó ver</a></td>`;
        }

        return `<td class="${cls}" title="${val}">${val}</td>`;
      }).join('');
      return `<tr>${tds}</tr>`;
    }).join('');

    set('tabla',`<div class="wrap-table"><table><thead><tr>${th}</tr></thead><tbody>${tbody}</tbody></table></div>`);

  }catch(err){
    document.getElementById('status').className = 'status err';
    set('status', `‚ùå Error: ${err.message}`);
    console.error(err);
  }
}

// Auto-cargar al abrir
cargar();
</script>
</body>
</html>
