<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debug â€” SimPrÃ©stamo</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@300;400;500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#080b10; --surf:#0f1319; --card:#141a24; --card2:#19202e;
  --b1:#1c2535; --b2:#243047;
  --acc:#00e5b0; --acc2:#00b88d;
  --blue:#3b82f6; --gold:#f59e0b; --red:#f43f5e; --purple:#a855f7;
  --txt:#dce8f5; --mut:#4d617d; --soft:#7a92b0;
  --r:12px; --rs:8px;
  --mono:'JetBrains Mono',monospace;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:15px;-webkit-tap-highlight-color:transparent}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--txt);min-height:100dvh;overflow-x:hidden}
body::before{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 60% 50% at 90% 5%,rgba(0,229,176,.06) 0%,transparent 60%),
    radial-gradient(ellipse 50% 60% at 5% 95%,rgba(59,130,246,.05) 0%,transparent 60%);
}
.wrap{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 18px 80px}

/* â”€â”€ HEADER â”€â”€ */
.hdr{display:flex;align-items:center;justify-content:space-between;padding:20px 0 16px;border-bottom:1px solid var(--b1);margin-bottom:20px;flex-wrap:wrap;gap:12px}
.logo{font-family:'Syne',sans-serif;font-weight:800;font-size:1.2rem;letter-spacing:-.03em}
.logo em{color:var(--acc);font-style:normal}
.logo sub{font-size:.55rem;color:var(--mut);font-family:'DM Sans',sans-serif;font-weight:400;vertical-align:middle;margin-left:6px;letter-spacing:.06em;text-transform:uppercase}
.hdr-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

/* STATUS BAR */
.status-bar{display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--card);border:1px solid var(--b1);border-radius:99px;font-size:.74rem}
.sdot{width:7px;height:7px;border-radius:50%;background:var(--mut);transition:background .3s;flex-shrink:0}
.sdot.ok{background:var(--acc)}
.sdot.err{background:var(--red)}
.sdot.busy{background:var(--blue);animation:blink .8s infinite}
.sdot.warn{background:var(--gold)}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.25}}
#statusTxt{color:var(--soft);font-family:var(--mono);font-size:.72rem}

/* â”€â”€ TABS â”€â”€ */
.tabs{display:flex;gap:4px;margin-bottom:18px;background:var(--card);border:1px solid var(--b1);border-radius:var(--r);padding:5px}
.tab{flex:1;padding:9px 12px;border:none;border-radius:var(--rs);background:transparent;color:var(--mut);font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:500;cursor:pointer;transition:background .15s,color .15s;display:flex;align-items:center;justify-content:center;gap:7px}
.tab:hover{background:var(--b1);color:var(--txt)}
.tab.on{background:var(--b2);color:var(--txt)}
.tab.sim.on{color:var(--acc)}
.tab.cli.on{color:var(--blue)}
.tab.raw.on{color:var(--purple)}
.tab.adm.on{color:var(--gold)}
.badge{font-size:.65rem;padding:2px 7px;border-radius:99px;font-weight:700;font-family:var(--mono)}
.tab.sim .badge{background:rgba(0,229,176,.15);color:var(--acc)}
.tab.cli .badge{background:rgba(59,130,246,.15);color:var(--blue)}
.tab.adm .badge{background:rgba(245,158,11,.15);color:var(--gold)}

/* â”€â”€ TOOLBAR â”€â”€ */
.toolbar{display:flex;align-items:center;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:99px;border:1.5px solid var(--b2);background:var(--surf);color:var(--soft);font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:500;cursor:pointer;transition:border-color .15s,color .15s,background .15s}
.btn:hover{border-color:var(--acc);color:var(--acc)}
.btn.primary{background:rgba(0,229,176,.1);border-color:var(--acc);color:var(--acc)}
.btn.primary:hover{background:rgba(0,229,176,.2)}
.btn:disabled{opacity:.35;cursor:not-allowed}
.search-box{flex:1;min-width:180px;position:relative}
.search-box input{width:100%;background:var(--surf);border:1.5px solid var(--b2);border-radius:99px;color:var(--txt);font-family:'DM Sans',sans-serif;font-size:.82rem;padding:8px 16px 8px 36px;outline:none;transition:border-color .15s}
.search-box input:focus{border-color:var(--acc)}
.search-box input::placeholder{color:var(--mut)}
.search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--mut);pointer-events:none}
.count-lbl{font-size:.72rem;color:var(--mut);font-family:var(--mono);white-space:nowrap}

/* â”€â”€ TABLE â”€â”€ */
.table-wrap{overflow-x:auto;border-radius:var(--r);border:1px solid var(--b1);background:var(--card)}
table{width:100%;border-collapse:collapse;font-size:.78rem;min-width:600px}
thead tr{background:var(--b1)}
th{padding:10px 12px;text-align:left;font-family:'Syne',sans-serif;font-size:.6rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:var(--mut);white-space:nowrap;border-bottom:1px solid var(--b2);position:sticky;top:0;z-index:2;background:var(--b1)}
th.sortable{cursor:pointer;user-select:none}
th.sortable:hover{color:var(--txt)}
th.sort-asc::after{content:' â–²';color:var(--acc)}
th.sort-desc::after{content:' â–¼';color:var(--acc)}
td{padding:9px 12px;border-bottom:1px solid var(--b1);vertical-align:middle;color:var(--soft);transition:background .1s}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.025)}
td.id{font-family:var(--mono);font-size:.7rem;color:var(--mut)}
td.name{color:var(--txt);font-weight:500}
td.tel{font-family:var(--mono);font-size:.73rem}
td.num{font-family:var(--mono);font-size:.73rem;text-align:right}
td.date{font-size:.72rem;white-space:nowrap}
td.link a{color:var(--blue);text-decoration:none;font-size:.72rem}
td.link a:hover{text-decoration:underline}
.pill{display:inline-block;padding:2px 9px;border-radius:99px;font-size:.66rem;font-weight:700;font-family:var(--mono)}
.pill-ok{background:rgba(0,229,176,.12);color:var(--acc);border:1px solid rgba(0,229,176,.25)}
.pill-warn{background:rgba(245,158,11,.12);color:var(--gold);border:1px solid rgba(245,158,11,.25)}
.pill-err{background:rgba(244,63,94,.12);color:var(--red);border:1px solid rgba(244,63,94,.25)}
.pill-blue{background:rgba(59,130,246,.12);color:var(--blue);border:1px solid rgba(59,130,246,.25)}
.pill-mut{background:var(--b1);color:var(--mut);border:1px solid var(--b2)}

/* â”€â”€ EMPTY / LOADER â”€â”€ */
.tbl-msg{padding:44px 20px;text-align:center;color:var(--mut);font-size:.82rem;line-height:1.8}
.tbl-msg .ico{font-size:2rem;display:block;margin-bottom:10px;opacity:.3}
.spinner{width:32px;height:32px;border:3px solid var(--b2);border-top-color:var(--acc);border-radius:50%;animation:spin .75s linear infinite;margin:0 auto 12px}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ RAW JSON â”€â”€ */
.raw-wrap{border-radius:var(--r);border:1px solid var(--b1);background:var(--card);overflow:hidden}
.raw-toolbar{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--b1);background:var(--b1)}
.raw-label{font-family:var(--mono);font-size:.7rem;color:var(--mut)}
pre{padding:16px;font-family:var(--mono);font-size:.72rem;color:var(--soft);line-height:1.6;overflow:auto;max-height:520px;white-space:pre-wrap;word-break:break-all}
pre .key{color:#7eb8ff}
pre .str{color:#a8e6a3}
pre .num{color:var(--gold)}
pre .bool{color:var(--acc)}
pre .null{color:var(--mut)}

/* â”€â”€ STATS CARDS â”€â”€ */
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;margin-bottom:18px}
.stat{background:var(--card);border:1px solid var(--b1);border-radius:var(--r);padding:14px 16px;position:relative;overflow:hidden}
.stat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.stat.acc::before{background:linear-gradient(90deg,var(--acc),transparent)}
.stat.blue::before{background:linear-gradient(90deg,var(--blue),transparent)}
.stat.gold::before{background:linear-gradient(90deg,var(--gold),transparent)}
.stat.purple::before{background:linear-gradient(90deg,var(--purple),transparent)}
.stat-lbl{font-size:.62rem;color:var(--mut);text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
.stat-val{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--txt)}
.stat-sub{font-size:.68rem;color:var(--mut);margin-top:3px}

/* â”€â”€ ADMIN CARD â”€â”€ */
.admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-bottom:18px}
.admin-card{background:var(--card);border:1px solid var(--b1);border-radius:var(--r);padding:16px;position:relative;overflow:hidden}
.admin-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),transparent)}
.admin-field{margin-bottom:10px}
.admin-field:last-child{margin-bottom:0}
.admin-key{font-size:.62rem;color:var(--mut);text-transform:uppercase;letter-spacing:.08em;margin-bottom:3px;font-family:'Syne',sans-serif}
.admin-val{font-family:var(--mono);font-size:.78rem;color:var(--txt);word-break:break-all}
.admin-val.big{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;color:var(--gold)}

/* â”€â”€ ERROR BOX â”€â”€ */
.err-box{background:rgba(244,63,94,.08);border:1px solid rgba(244,63,94,.25);border-radius:var(--r);padding:14px 16px;font-family:var(--mono);font-size:.75rem;color:#ff6b8a;margin-bottom:14px;line-height:1.6}
.err-box strong{color:var(--red);display:block;margin-bottom:4px}

/* â”€â”€ TOAST â”€â”€ */
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(60px);background:var(--card2);border:1px solid var(--b2);padding:8px 18px;border-radius:99px;font-size:.78rem;color:var(--txt);box-shadow:0 8px 24px rgba(0,0,0,.5);transition:transform .3s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;z-index:300;pointer-events:none;max-width:calc(100vw - 32px)}
#toast.show{transform:translateX(-50%) translateY(0)}
#toast.ok{border-color:rgba(0,229,176,.3);color:var(--acc)}
#toast.err{border-color:rgba(244,63,94,.3);color:#ff6b8a}

@media(max-width:600px){
  .tab span{display:none}
  .tabs{gap:2px}
  .tab{padding:9px 8px}
  .stats{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>
<div class="wrap">

  <!-- HEADER -->
  <header class="hdr">
    <div class="logo">Sim<em>PrÃ©stamo</em> <sub>debug panel</sub></div>
    <div class="hdr-right">
      <div class="status-bar">
        <div class="sdot" id="sdot"></div>
        <span id="statusTxt">Inicializandoâ€¦</span>
      </div>
      <button class="btn primary" onclick="recargarTodo()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
          <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
        Recargar
      </button>
    </div>
  </header>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab sim on" onclick="setTab('sim')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      <span>Simulaciones</span>
      <span class="badge" id="badgeSim">â€”</span>
    </button>
    <button class="tab cli" onclick="setTab('cli')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span>Clientes</span>
      <span class="badge" id="badgeCli">â€”</span>
    </button>
    <button class="tab adm" onclick="setTab('adm')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93A10 10 0 1 0 21 12"/></svg>
      <span>Admin</span>
    </button>
    <button class="tab raw" onclick="setTab('raw')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
      <span>JSON Raw</span>
    </button>
  </div>

  <!-- â•â• PANEL: SIMULACIONES â•â• -->
  <div id="panelSim">
    <div class="stats" id="statsSim"></div>
    <div id="errSim"></div>
    <div class="toolbar">
      <button class="btn primary" onclick="cargarSimulaciones()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="23 4 23 10 17 10"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/></svg>
        Leer Sheets
      </button>
      <div class="search-box">
        <svg class="search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="searchSim" placeholder="Buscar ID, nombre, telÃ©fonoâ€¦" oninput="filtrarSim()">
      </div>
      <span class="count-lbl" id="countSim">0 registros</span>
    </div>
    <div class="table-wrap" id="tableSim">
      <div class="tbl-msg"><span class="ico">ğŸ“„</span>Presiona "Leer Sheets" para cargar datos</div>
    </div>
  </div>

  <!-- â•â• PANEL: CLIENTES â•â• -->
  <div id="panelCli" style="display:none">
    <div class="stats" id="statsCli"></div>
    <div id="errCli"></div>
    <div class="toolbar">
      <button class="btn primary" onclick="cargarClientes()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="23 4 23 10 17 10"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/></svg>
        Leer Sheets
      </button>
      <div class="search-box">
        <svg class="search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="searchCli" placeholder="Buscar ID, nombre, telÃ©fono, correoâ€¦" oninput="filtrarCli()">
      </div>
      <span class="count-lbl" id="countCli">0 registros</span>
    </div>
    <div class="table-wrap" id="tableCli">
      <div class="tbl-msg"><span class="ico">ğŸ‘¤</span>Presiona "Leer Sheets" para cargar datos</div>
    </div>
  </div>

  <!-- â•â• PANEL: ADMIN â•â• -->
  <div id="panelAdm" style="display:none">
    <div id="errAdm"></div>
    <div class="toolbar">
      <button class="btn primary" onclick="cargarAdmin()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="23 4 23 10 17 10"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/></svg>
        Leer TelefonoAdmin
      </button>
    </div>
    <div class="admin-grid" id="adminGrid">
      <div class="tbl-msg"><span class="ico">âš™ï¸</span>Presiona "Leer TelefonoAdmin" para cargar</div>
    </div>
  </div>

  <!-- â•â• PANEL: JSON RAW â•â• -->
  <div id="panelRaw" style="display:none">
    <div class="toolbar">
      <select id="rawSelect" style="background:var(--surf);border:1.5px solid var(--b2);border-radius:99px;color:var(--txt);font-family:'DM Sans',sans-serif;font-size:.8rem;padding:7px 14px;outline:none;cursor:pointer">
        <option value="Simulaciones">Simulaciones</option>
        <option value="Clientes">Clientes</option>
        <option value="TelefonoAdmin">TelefonoAdmin</option>
        <option value="Dias">Dias</option>
        <option value="Capital">Capital</option>
        <option value="Interes">Interes</option>
        <option value="Banner">Banner</option>
      </select>
      <button class="btn primary" onclick="cargarRaw()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="23 4 23 10 17 10"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/></svg>
        Cargar JSON
      </button>
      <button class="btn" onclick="copiarRaw()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copiar
      </button>
    </div>
    <div class="raw-wrap">
      <div class="raw-toolbar">
        <span class="raw-label" id="rawLabel">â€” Sin datos â€”</span>
        <span class="raw-label" id="rawSize"></span>
      </div>
      <pre id="rawPre">Selecciona una pestaÃ±a y presiona Cargar JSON</pre>
    </div>
  </div>

</div>
<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG â€” mismo SHEET_ID que el proyecto
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SHEET_ID = '19Viesr9Lhy347A9L03J_RuxftUhBduaYsBY206IO6X8';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let dataSim = [];   // filas crudas Simulaciones
let dataCli = [];   // filas crudas Clientes
let filtSim = [];   // filas filtradas Simulaciones
let filtCli = [];   // filas filtradas Clientes
let sortCol = null;
let sortDir = 1;
let tabActual = 'sim';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILIDADES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const gi = id => document.getElementById(id);
function dot(m){ gi('sdot').className='sdot '+(m||''); }
function status(txt, m){ dot(m); gi('statusTxt').textContent=txt; }

let _tT;
function toast(msg, tipo=''){
  clearTimeout(_tT);
  const el=gi('toast');
  el.textContent=msg; el.className='show'+(tipo?' '+tipo:'');
  _tT=setTimeout(()=>el.classList.remove('show'),3000);
}

function fmt(n){
  if(n===''||n===null||n===undefined) return 'â€”';
  return '$'+Number(n).toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2});
}
function fmtN(n){
  if(n===''||n===null||n===undefined) return 'â€”';
  return Number(n).toLocaleString('es-MX');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FETCH SHEET CRUDO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchSheet(nombre){
  status(`Leyendo "${nombre}"â€¦`, 'busy');
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(nombre)}`;
  const r = await fetch(url, {cache:'no-store'});
  if(!r.ok) throw new Error(`HTTP ${r.status} al leer "${nombre}"`);
  const txt = await r.text();
  const json = JSON.parse(txt.replace(/^[\s\S]*?setResponse\(/,'').replace(/\);[\s\S]*$/,''));
  return json;
}

/* Extrae headers y filas como arrays de valores */
function parsearTabla(json){
  const cols = (json.table?.cols || []).map(c => c.label || c.id || '?');
  const rows = (json.table?.rows || []).map(row =>
    (row.c || []).map(cell => {
      if(cell === null) return '';
      return cell.f !== undefined && cell.f !== null ? cell.f : (cell.v !== undefined ? cell.v : '');
    })
  );
  return { cols, rows };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setTab(t){
  tabActual = t;
  ['sim','cli','adm','raw'].forEach(x => {
    gi('panel'+x.charAt(0).toUpperCase()+x.slice(1)).style.display = x===t ? '' : 'none';
    document.querySelector('.tab.'+x).classList.toggle('on', x===t);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIMULACIONES
   Columnas esperadas:
   A=ID  B=IdCliente  C=Fecha/Hora  D=Nombre  E=TelÃ©fono
   F=Capital  G=DÃ­as  H=InterÃ©s%  I=InterÃ©s$  J=Total  K=PagoDiario
   L=Lat  M=Lng  N=DirecciÃ³n  O=LinkMapa  P=FotoINE  Q=FotoComp
   R=Estado  S=Notas  T=Correo
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function cargarSimulaciones(){
  gi('errSim').innerHTML='';
  gi('tableSim').innerHTML='<div class="tbl-msg"><div class="spinner"></div>Cargando Simulacionesâ€¦</div>';
  try{
    const json = await fetchSheet('Simulaciones');
    const { cols, rows } = parsearTabla(json);

    if(!rows.length){
      gi('tableSim').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ“­</span>La pestaÃ±a Simulaciones estÃ¡ vacÃ­a.<br>AÃºn no hay registros.</div>';
      gi('badgeSim').textContent='0';
      gi('countSim').textContent='0 registros';
      renderStatsSim([]);
      status('Simulaciones: vacÃ­a','warn');
      dataSim=[]; filtSim=[];
      return;
    }

    dataSim = rows;
    filtSim  = rows;
    gi('badgeSim').textContent = rows.length;
    gi('searchSim').value='';
    renderStatsSim(rows);
    renderTablaSim(rows);
    status(`Simulaciones: ${rows.length} filas`, 'ok');
    toast(`âœ“ ${rows.length} simulaciones cargadas`, 'ok');
  }catch(e){
    gi('tableSim').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ’¥</span>Error al leer la pestaÃ±a</div>';
    gi('errSim').innerHTML=`<div class="err-box"><strong>âŒ Error al leer Simulaciones</strong>${e.message}</div>`;
    status('Error leyendo Simulaciones','err');
    toast('Error: '+e.message,'err');
  }
}

function renderStatsSim(rows){
  const total    = rows.length;
  const completos= rows.filter(r => String(r[17]||'').includes('Completo')).length;
  const capitales= rows.map(r => Number(r[5])||0).filter(n=>n>0);
  const totalCap = capitales.reduce((a,b)=>a+b,0);
  const totalInt = rows.map(r=>Number(r[8])||0).reduce((a,b)=>a+b,0);

  gi('statsSim').innerHTML=`
    <div class="stat acc">
      <div class="stat-lbl">Total simulaciones</div>
      <div class="stat-val">${total}</div>
      <div class="stat-sub">${completos} completas Â· ${total-completos} nuevas</div>
    </div>
    <div class="stat blue">
      <div class="stat-lbl">Capital total</div>
      <div class="stat-val">${total?fmt(totalCap):'â€”'}</div>
      <div class="stat-sub">suma de todos los prÃ©stamos</div>
    </div>
    <div class="stat gold">
      <div class="stat-lbl">InterÃ©s total generado</div>
      <div class="stat-val">${total?fmt(totalInt):'â€”'}</div>
      <div class="stat-sub">suma de intereses</div>
    </div>
    <div class="stat purple">
      <div class="stat-lbl">Capital promedio</div>
      <div class="stat-val">${capitales.length?fmt(totalCap/capitales.length):'â€”'}</div>
      <div class="stat-sub">por simulaciÃ³n</div>
    </div>
  `;
}

function renderTablaSim(rows){
  if(!rows.length){
    gi('tableSim').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ”</span>Sin resultados para esa bÃºsqueda</div>';
    gi('countSim').textContent='0 registros';
    return;
  }
  gi('countSim').textContent=rows.length+' registro'+(rows.length!==1?'s':'');
  let html=`<table><thead><tr>
    <th>#</th>
    <th class="sortable" onclick="sortSim(0)">ID</th>
    <th class="sortable" onclick="sortSim(1)">IdCliente</th>
    <th class="sortable" onclick="sortSim(2)">Fecha/Hora</th>
    <th class="sortable" onclick="sortSim(3)">Nombre</th>
    <th class="sortable" onclick="sortSim(4)">TelÃ©fono</th>
    <th class="sortable" onclick="sortSim(5)">Capital</th>
    <th class="sortable" onclick="sortSim(6)">DÃ­as</th>
    <th>Tasa%</th>
    <th>InterÃ©s$</th>
    <th class="sortable" onclick="sortSim(9)">Total</th>
    <th>Pago/dÃ­a</th>
    <th>Estado</th>
    <th>Correo</th>
    <th>Mapa</th>
    <th>Notas</th>
  </tr></thead><tbody>`;

  rows.forEach((r,i)=>{
    const estado = String(r[17]||'');
    const pillE  = estado.includes('Completo')
      ? `<span class="pill pill-ok">${estado.replace('âœ… ','')}</span>`
      : `<span class="pill pill-warn">${estado.replace('âš ï¸ ','')||'Nuevo'}</span>`;
    const mapa   = r[14] ? `<a href="${r[14]}" target="_blank">ğŸ“ Ver</a>` : 'â€”';
    const nota   = r[18] ? `<span title="${r[18]}">ğŸ“ ${String(r[18]).slice(0,20)}${r[18].length>20?'â€¦':''}</span>` : 'â€”';

    html+=`<tr>
      <td class="id" style="color:var(--mut)">${i+1}</td>
      <td class="id">${r[0]||'â€”'}</td>
      <td class="id" style="font-size:.66rem">${r[1]||'â€”'}</td>
      <td class="date">${r[2]||'â€”'}</td>
      <td class="name">${r[3]||'â€”'}</td>
      <td class="tel">${r[4]||'â€”'}</td>
      <td class="num">${fmt(r[5])}</td>
      <td class="num">${r[6]||'â€”'}</td>
      <td class="num">${r[7]?r[7]+'%':'â€”'}</td>
      <td class="num">${fmt(r[8])}</td>
      <td class="num" style="color:var(--acc);font-weight:600">${fmt(r[9])}</td>
      <td class="num">${fmt(r[10])}</td>
      <td>${pillE}</td>
      <td class="tel" style="font-size:.68rem">${r[19]||'â€”'}</td>
      <td class="link">${mapa}</td>
      <td>${nota}</td>
    </tr>`;
  });
  html+='</tbody></table>';
  gi('tableSim').innerHTML=html;
}

function filtrarSim(){
  const q = gi('searchSim').value.toLowerCase().trim();
  filtSim = q
    ? dataSim.filter(r => r.some(c => String(c).toLowerCase().includes(q)))
    : dataSim;
  renderTablaSim(filtSim);
}

function sortSim(col){
  if(sortCol===col) sortDir*=-1; else { sortCol=col; sortDir=1; }
  filtSim.sort((a,b)=>{
    const av=a[col]||'', bv=b[col]||'';
    const an=Number(av), bn=Number(bv);
    if(!isNaN(an)&&!isNaN(bn)) return (an-bn)*sortDir;
    return String(av).localeCompare(String(bv))*sortDir;
  });
  renderTablaSim(filtSim);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLIENTES
   Columnas esperadas:
   A=IdCliente  B=Nombre Cliente  C=Telefono  D=Ubicacion
   E=Correo  F=FotoIne  G=FotoComprobante
   H=CantidadSimulaciones  I=Estado
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function cargarClientes(){
  gi('errCli').innerHTML='';
  gi('tableCli').innerHTML='<div class="tbl-msg"><div class="spinner"></div>Cargando Clientesâ€¦</div>';
  try{
    const json = await fetchSheet('Clientes');
    const { cols, rows } = parsearTabla(json);

    if(!rows.length){
      gi('tableCli').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ“­</span>La pestaÃ±a Clientes estÃ¡ vacÃ­a.<br>AÃºn no hay clientes registrados.</div>';
      gi('badgeCli').textContent='0';
      gi('countCli').textContent='0 registros';
      renderStatsCli([]);
      status('Clientes: vacÃ­a','warn');
      dataCli=[]; filtCli=[];
      return;
    }

    dataCli = rows;
    filtCli  = rows;
    gi('badgeCli').textContent = rows.length;
    gi('searchCli').value='';
    renderStatsCli(rows);
    renderTablaCli(rows);
    status(`Clientes: ${rows.length} filas`, 'ok');
    toast(`âœ“ ${rows.length} clientes cargados`, 'ok');
  }catch(e){
    gi('tableCli').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ’¥</span>Error al leer la pestaÃ±a</div>';
    gi('errCli').innerHTML=`<div class="err-box"><strong>âŒ Error al leer Clientes</strong>${e.message}<br><br><strong>DiagnÃ³stico:</strong> Es posible que la pestaÃ±a "Clientes" no exista aÃºn.<br>Ejecuta la funciÃ³n <code>inicializarHoja()</code> en Apps Script, o envÃ­a una simulaciÃ³n para crearla automÃ¡ticamente.</div>`;
    status('Error leyendo Clientes','err');
    toast('Error: '+e.message,'err');
  }
}

function renderStatsCli(rows){
  const total    = rows.length;
  const activos  = rows.filter(r => String(r[8]||'').toLowerCase().includes('activo')).length;
  const conFoto  = rows.filter(r => r[5] && String(r[5]).startsWith('http')).length;
  const totalSims= rows.map(r=>Number(r[7])||0).reduce((a,b)=>a+b,0);

  gi('statsCli').innerHTML=`
    <div class="stat blue">
      <div class="stat-lbl">Total clientes</div>
      <div class="stat-val">${total}</div>
      <div class="stat-sub">${activos} activos</div>
    </div>
    <div class="stat acc">
      <div class="stat-lbl">Simulaciones totales</div>
      <div class="stat-val">${totalSims}</div>
      <div class="stat-sub">entre todos los clientes</div>
    </div>
    <div class="stat gold">
      <div class="stat-lbl">Con foto INE</div>
      <div class="stat-val">${conFoto}</div>
      <div class="stat-sub">${total?Math.round(conFoto/total*100):0}% del total</div>
    </div>
    <div class="stat purple">
      <div class="stat-lbl">Promedio simulaciones</div>
      <div class="stat-val">${total?(totalSims/total).toFixed(1):'â€”'}</div>
      <div class="stat-sub">por cliente</div>
    </div>
  `;
}

function renderTablaCli(rows){
  if(!rows.length){
    gi('tableCli').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ”</span>Sin resultados para esa bÃºsqueda</div>';
    gi('countCli').textContent='0 registros';
    return;
  }
  gi('countCli').textContent=rows.length+' registro'+(rows.length!==1?'s':'');
  let html=`<table><thead><tr>
    <th>#</th>
    <th class="sortable" onclick="sortCli(0)">IdCliente</th>
    <th class="sortable" onclick="sortCli(1)">Nombre Cliente</th>
    <th class="sortable" onclick="sortCli(2)">TelÃ©fono</th>
    <th>UbicaciÃ³n</th>
    <th>Correo</th>
    <th>FotoIne</th>
    <th>FotoComprobante</th>
    <th class="sortable" onclick="sortCli(7)">Cant. Sims</th>
    <th class="sortable" onclick="sortCli(8)">Estado</th>
  </tr></thead><tbody>`;

  rows.forEach((r,i)=>{
    const estado = String(r[8]||'');
    let pillE;
    if(estado.toLowerCase().includes('activo')) pillE=`<span class="pill pill-ok">${estado.replace('âœ… ','')}</span>`;
    else if(estado.toLowerCase().includes('inactivo')) pillE=`<span class="pill pill-err">${estado}</span>`;
    else if(estado) pillE=`<span class="pill pill-mut">${estado}</span>`;
    else pillE='â€”';

    const fotoIne  = r[5] && String(r[5]).startsWith('http')
      ? `<a href="${r[5]}" target="_blank"><span class="pill pill-blue">ğŸ“„ Ver</span></a>`
      : (r[5]?`<span class="pill pill-mut">${String(r[5]).slice(0,12)}â€¦</span>`:'<span style="color:var(--mut)">â€”</span>');
    const fotoComp = r[6] && String(r[6]).startsWith('http')
      ? `<a href="${r[6]}" target="_blank"><span class="pill pill-blue">ğŸ“„ Ver</span></a>`
      : (r[6]?`<span class="pill pill-mut">${String(r[6]).slice(0,12)}â€¦</span>`:'<span style="color:var(--mut)">â€”</span>');

    const ubi = r[3] ? `<span title="${r[3]}">ğŸ“ ${String(r[3]).slice(0,28)}${r[3].length>28?'â€¦':''}</span>` : 'â€”';
    const sims = Number(r[7])||0;
    const simsPill = sims>0
      ? `<span class="pill pill-blue">${sims}</span>`
      : `<span class="pill pill-mut">0</span>`;

    html+=`<tr>
      <td class="id" style="color:var(--mut)">${i+1}</td>
      <td class="id">${r[0]||'â€”'}</td>
      <td class="name">${r[1]||'â€”'}</td>
      <td class="tel">${r[2]||'â€”'}</td>
      <td style="font-size:.72rem;color:var(--soft)">${ubi}</td>
      <td class="tel" style="font-size:.68rem">${r[4]||'â€”'}</td>
      <td class="link">${fotoIne}</td>
      <td class="link">${fotoComp}</td>
      <td style="text-align:center">${simsPill}</td>
      <td>${pillE}</td>
    </tr>`;
  });
  html+='</tbody></table>';
  gi('tableCli').innerHTML=html;
}

function filtrarCli(){
  const q = gi('searchCli').value.toLowerCase().trim();
  filtCli = q
    ? dataCli.filter(r => r.some(c => String(c).toLowerCase().includes(q)))
    : dataCli;
  renderTablaCli(filtCli);
}

function sortCli(col){
  if(sortCol===col) sortDir*=-1; else { sortCol=col; sortDir=1; }
  filtCli.sort((a,b)=>{
    const av=a[col]||'', bv=b[col]||'';
    const an=Number(av), bn=Number(bv);
    if(!isNaN(an)&&!isNaN(bn)) return (an-bn)*sortDir;
    return String(av).localeCompare(String(bv))*sortDir;
  });
  renderTablaCli(filtCli);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN â€” TelefonoAdmin
   Formato HORIZONTAL:
     Fila 1 (encabezados): IdAdmin | NombreEmpresa | TelefonoAdmin | Email | Activo | logoEmpresa
     Fila 2 (valores):     val0    | val1          | val2          | val3  | val4   | val5
   â†’ Leemos la fila de encabezados (cols) y la fila de datos (rows[0])
     y los emparejamos columna por columna para mostrarlo como tarjeta.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function cargarAdmin(){
  gi('errAdm').innerHTML='';
  gi('adminGrid').innerHTML='<div class="tbl-msg"><div class="spinner"></div>Cargando TelefonoAdminâ€¦</div>';
  try{
    const json = await fetchSheet('TelefonoAdmin');

    // Leer encabezados desde cols (fila 1 de la hoja)
    const headers = (json.table?.cols || []).map(c => (c.label||c.id||'').trim()).filter(Boolean);

    // Leer fila de datos (fila 2 = rows[0] en gviz, ya que gviz salta la fila de encabezado)
    const rawRows = json.table?.rows || [];

    if(!headers.length && !rawRows.length){
      gi('adminGrid').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ“­</span>La pestaÃ±a TelefonoAdmin estÃ¡ vacÃ­a.</div>';
      status('TelefonoAdmin: vacÃ­a','warn');
      return;
    }

    // Si los headers estÃ¡n vacÃ­os (sin etiquetas en cols), usar nombres conocidos como fallback
    const COLS = ['IdAdmin','NombreEmpresa','TelefonoAdmin','Email','Activo','logoEmpresa'];
    const labels = headers.length >= 3 ? headers : COLS;

    // Mapa: nombreCol â†’ valor (de la primera fila de datos)
    // Puede haber varias filas si hay mÃºltiples admins â€” mostramos una tarjeta por fila
    if(!rawRows.length){
      gi('adminGrid').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ“­</span>Encabezados encontrados pero sin datos en fila 2.</div>';
      status('TelefonoAdmin: sin datos','warn');
      return;
    }

    // Mostrar encabezados detectados como info de diagnÃ³stico
    let html=`<div style="grid-column:1/-1;padding:10px 14px;background:var(--b1);border-radius:var(--rs);font-size:.68rem;color:var(--mut);font-family:var(--mono);margin-bottom:4px">
      <span style="color:var(--acc)">Encabezados detectados (${labels.length}):</span>
      ${labels.map((l,i)=>`<span style="color:var(--soft)">[${i}]</span> ${l}`).join(' Â· ')}
    </div>`;

    // Una tarjeta por cada fila de datos (fila 2 en adelante)
    rawRows.forEach((row, rowIdx) => {
      const vals = (row.c || []).map(cell => {
        if(!cell) return '';
        return cell.f !== undefined && cell.f !== null ? cell.f : (cell.v !== undefined && cell.v !== null ? String(cell.v) : '');
      });

      // Construir mapa label â†’ valor usando los Ã­ndices de COLS
      const get = (nombre) => {
        const idx = COLS.findIndex(c => c.toLowerCase() === nombre.toLowerCase());
        // tambiÃ©n buscar en labels detectados
        const idx2 = labels.findIndex(l => l.toLowerCase().includes(nombre.toLowerCase()));
        const i = idx >= 0 ? idx : idx2;
        return i >= 0 ? (vals[i] || '') : '';
      };

      const idAdmin      = get('IdAdmin')       || vals[0] || 'â€”';
      const empresa      = get('NombreEmpresa') || vals[1] || 'â€”';
      const telefono     = get('TelefonoAdmin') || vals[2] || 'â€”';
      const email        = get('Email')         || vals[3] || 'â€”';
      const activoRaw    = get('Activo')        || vals[4] || '';
      const logo         = get('logoEmpresa')   || vals[5] || '';

      const activo = String(activoRaw).toUpperCase() === 'TRUE' || String(activoRaw) === '1';
      const pill   = activo
        ? `<span class="pill pill-ok">âœ“ Activo</span>`
        : `<span class="pill pill-err">âœ— Inactivo</span>`;

      const logoHtml = logo
        ? `<a href="${logo}" target="_blank" style="color:var(--blue)">Ver logo ğŸ–¼ï¸</a>`
        : '<span style="color:var(--mut)">â€”</span>';

      html += `<div class="admin-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px">
          <span class="pill pill-mut" style="font-size:.6rem">Fila ${rowIdx+2}</span>
          ${pill}
        </div>
        <div class="admin-field">
          <div class="admin-key">IdAdmin</div>
          <div class="admin-val" style="font-family:var(--mono);font-size:.72rem">${idAdmin}</div>
        </div>
        <div class="admin-field">
          <div class="admin-key">NombreEmpresa</div>
          <div class="admin-val big">${empresa}</div>
        </div>
        <div class="admin-field">
          <div class="admin-key">TelefonoAdmin</div>
          <div class="admin-val" style="color:var(--acc);font-family:var(--mono)">${telefono}</div>
        </div>
        <div class="admin-field">
          <div class="admin-key">Email</div>
          <div class="admin-val" style="font-size:.75rem">${email}</div>
        </div>
        <div class="admin-field">
          <div class="admin-key">Activo (raw)</div>
          <div class="admin-val" style="font-family:var(--mono);font-size:.7rem">${activoRaw || 'â€”'}</div>
        </div>
        <div class="admin-field">
          <div class="admin-key">logoEmpresa</div>
          <div class="admin-val">${logoHtml}</div>
        </div>
        <div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--b1)">
          <div style="font-size:.62rem;color:var(--mut);margin-bottom:6px;font-family:var(--mono)">Valores raw por columna:</div>
          <div style="display:flex;flex-wrap:wrap;gap:4px">
            ${vals.map((v,i)=>`<span style="background:var(--b1);border-radius:4px;padding:2px 7px;font-size:.6rem;font-family:var(--mono);color:var(--soft)"><span style="color:var(--mut)">[${i}]</span> ${v||'âˆ…'}</span>`).join('')}
          </div>
        </div>
      </div>`;
    });

    gi('adminGrid').innerHTML=html;
    status(`TelefonoAdmin: ${rawRows.length} fila(s) de datos`, 'ok');
    toast(`âœ“ TelefonoAdmin cargado (${rawRows.length} fila${rawRows.length!==1?'s':''})`, 'ok');

  }catch(e){
    gi('adminGrid').innerHTML='<div class="tbl-msg"><span class="ico">ğŸ’¥</span>Error al leer la pestaÃ±a</div>';
    gi('errAdm').innerHTML=`<div class="err-box"><strong>âŒ Error al leer TelefonoAdmin</strong><br>${e.message}<br><br>
      Tip: verifica que la hoja sea pÃºblica o compartida para lectura.</div>`;
    status('Error leyendo TelefonoAdmin','err');
    toast('Error: '+e.message,'err');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JSON RAW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let rawData = null;
async function cargarRaw(){
  const nombre = gi('rawSelect').value;
  gi('rawLabel').textContent='Cargandoâ€¦';
  gi('rawSize').textContent='';
  gi('rawPre').textContent='Cargandoâ€¦';
  try{
    const json = await fetchSheet(nombre);
    rawData = json;
    const str = JSON.stringify(json, null, 2);
    gi('rawLabel').textContent=`sheet: ${nombre}`;
    gi('rawSize').textContent=`${(str.length/1024).toFixed(1)} KB Â· ${json.table?.rows?.length||0} filas`;
    gi('rawPre').innerHTML=syntaxHL(str);
    status('Raw cargado','ok');
    toast(`âœ“ Raw "${nombre}" cargado (${(str.length/1024).toFixed(1)} KB)`,'ok');
  }catch(e){
    gi('rawLabel').textContent='Error';
    gi('rawPre').textContent='Error: '+e.message;
    status('Error raw','err');
    toast('Error: '+e.message,'err');
  }
}

function syntaxHL(json){
  return json
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, m => {
      let cls='num';
      if(/^"/.test(m)){
        if(/:$/.test(m)) cls='key';
        else cls='str';
      } else if(/true|false/.test(m)) cls='bool';
      else if(/null/.test(m)) cls='null';
      return `<span class="${cls}">${m}</span>`;
    });
}

function copiarRaw(){
  if(!rawData){ toast('Primero carga el JSON','err'); return; }
  navigator.clipboard.writeText(JSON.stringify(rawData,null,2))
    .then(()=>toast('âœ“ JSON copiado al portapapeles','ok'))
    .catch(()=>toast('Error al copiar','err'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RECARGAR TODO (botÃ³n del header)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function recargarTodo(){
  if(tabActual==='sim') await cargarSimulaciones();
  else if(tabActual==='cli') await cargarClientes();
  else if(tabActual==='adm') await cargarAdmin();
  else await cargarRaw();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT â€” carga automÃ¡tica al abrir
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function init(){
  dot(navigator.onLine?'ok':'off');
  gi('statusTxt').textContent = navigator.onLine ? 'Listo' : 'Sin conexiÃ³n';
  window.addEventListener('online',  ()=>{ dot('ok');  gi('statusTxt').textContent='Conectado'; });
  window.addEventListener('offline', ()=>{ dot('err'); gi('statusTxt').textContent='Sin conexiÃ³n'; });

  // Cargar Simulaciones y Clientes automÃ¡ticamente al abrir
  await cargarSimulaciones();
  await cargarClientes();
}

init();
</script>
</body>
</html>
